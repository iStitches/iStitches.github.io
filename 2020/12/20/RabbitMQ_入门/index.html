<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>RabbitMQ(一)、基础入门 | iStitches</title><meta name="keywords" content="RabbitMQ"><meta name="author" content="XjX-zc"><meta name="copyright" content="XjX-zc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、什么叫做消息队列消息（Message）指在应用间传输的数据。消息包含 数字、文本、更复杂的嵌入对象等等。 消息队列（Message Queue）是一种应用间的通信方式，消息发送后可以立即返回，由消息系统来确保消息的可靠传输。消息发布者只管把消息发送到 MQ 中而不管谁来取，消费者只管从 MQ 中拿消息而不管谁发送的消息。消息的发送和接收都不知道双方的存在。">
<meta property="og:type" content="article">
<meta property="og:title" content="RabbitMQ(一)、基础入门">
<meta property="og:url" content="http://example.com/2020/12/20/RabbitMQ_%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="iStitches">
<meta property="og:description" content="一、什么叫做消息队列消息（Message）指在应用间传输的数据。消息包含 数字、文本、更复杂的嵌入对象等等。 消息队列（Message Queue）是一种应用间的通信方式，消息发送后可以立即返回，由消息系统来确保消息的可靠传输。消息发布者只管把消息发送到 MQ 中而不管谁来取，消费者只管从 MQ 中拿消息而不管谁发送的消息。消息的发送和接收都不知道双方的存在。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/RabbitMQ.jpg">
<meta property="article:published_time" content="2020-12-20T13:06:00.000Z">
<meta property="article:modified_time" content="2022-04-02T02:38:10.147Z">
<meta property="article:author" content="XjX-zc">
<meta property="article:tag" content="RabbitMQ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/RabbitMQ.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2020/12/20/RabbitMQ_%E5%85%A5%E9%97%A8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'RabbitMQ(一)、基础入门',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-04-02 10:38:10'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mycss.css"><link rel="stylesheet" href="/css/mybkcss.css"><link rel="stylesheet" href="/css/myfootercss.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_3294417_y9wnoregopg.css"><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/myfont.css"><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="iStitches" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/loading.gif" data-original="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">48</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/RabbitMQ.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">iStitches</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E5%85%B3%E4%BA%8E"><i class="fa-fw /about/"></i><span> 0</span></a></li><li><a class="site-page child" href="/myself"><i class="fa-fw /myself/"></i><span> 1</span></a></li><li><a class="site-page child" href="/butterfly%E4%B8%BB%E9%A2%98"><i class="fa-fw https://github.com/jerryc127/hexo-theme-butterfly/"></i><span> 2</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">RabbitMQ(一)、基础入门</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-12-20T13:06:00.000Z" title="发表于 2020-12-20 21:06:00">2020-12-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-04-02T02:38:10.147Z" title="更新于 2022-04-02 10:38:10">2022-04-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="RabbitMQ(一)、基础入门"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一、什么叫做消息队列"><a href="#一、什么叫做消息队列" class="headerlink" title="一、什么叫做消息队列"></a>一、什么叫做消息队列</h2><p>消息（Message）指在应用间传输的数据。消息包含 数字、文本、更复杂的嵌入对象等等。</p>
<p>消息队列（Message Queue）是一种应用间的通信方式，消息发送后可以立即返回，由消息系统来确保消息的可靠传输。消息发布者只管把消息发送到 MQ 中而不管谁来取，消费者只管从 MQ 中拿消息而不管谁发送的消息。消息的发送和接收都不知道双方的存在。</p>
<span id="more"></span>

<h2 id="二、消息队列出现的原因"><a href="#二、消息队列出现的原因" class="headerlink" title="二、消息队列出现的原因"></a>二、消息队列出现的原因</h2><p>消息队列是一种异步协作的机制。</p>
<p>比如说订单系统，一般订单涉及的业务操作包括：扣减库存、生成订单信息、发红包、发送短信提示等。业务量较少时这些操作可以放在一起同步执行，但随着业务量的增多，需要提升系统的服务性能，这时可以将一些不需要立即生效的操作单独抽取出来异步执行。比如说 发红包、发短信提示 这两个操作可以不用那么急，这种情况下使用 MQ，在下单的主流程（扣减库存、生成订单信息）完成后发送一条消息到 MQ　让主流程快速完结，而另外的由单独的线程拉取  MQ 的消息，当发现 MQ 中有对应的消息时进行执行。</p>
<blockquote>
<p>常用场景包括： 最终一致性、广播、错峰流控等。</p>
</blockquote>
<h2 id="三、RabbitMQ-特点"><a href="#三、RabbitMQ-特点" class="headerlink" title="三、RabbitMQ 特点"></a>三、RabbitMQ 特点</h2><blockquote>
<p>RabbitMQ 是一款由 Erlang 语言开发的 AMQP 的开源实现。</p>
</blockquote>
<p>AMQP： Advanced Message Queue，高级消息队列协议。它是应用层协议的一个标准。</p>
<p>RabbitMQ 主要特性如下：</p>
<ol>
<li>可靠性（Reliability）RabbitMQ 使用一些机制来保证可靠性，比如持久化、传输确认、发布确认。</li>
<li>灵活的路由（Flexible Routing）在消息进入消息队列之前，通过 Exchange交换机来路由消息。对于典型的路由功能，已经有了一些内置的交换机来实现；但是对于更复杂的路由，可以将多个交换机绑定到一起来实现。</li>
<li>消息集群（Clustering）多个RabbitMQ 服务器可以组合成为一个集群。</li>
<li>高可用（High Available Queues）队列可以在集群中的服务器上进行镜像，使得部分结点在出现问题的情况下队列仍然可以使用。</li>
<li>多种协议（Multi-protocol）RabbitMQ 支持多种消息队列协议，如 STOMP、MQTT。</li>
<li>多语言客户端（Many Clients）RabbitMQ 支持多种常用的语言。</li>
<li>管理界面、跟踪机制、插件机制。</li>
</ol>
<h2 id="四、RabbitMQ-中的概念"><a href="#四、RabbitMQ-中的概念" class="headerlink" title="四、RabbitMQ 中的概念"></a>四、RabbitMQ 中的概念</h2><h3 id="4-1-消息模型"><a href="#4-1-消息模型" class="headerlink" title="4.1 消息模型"></a>4.1 消息模型</h3><p><img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/161260568dd200d6"></p>
<h3 id="4-2-RabbitMQ-基本概念"><a href="#4-2-RabbitMQ-基本概念" class="headerlink" title="4.2 RabbitMQ 基本概念"></a>4.2 RabbitMQ 基本概念</h3><p><img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/161260568dd66584"></p>
<ol>
<li>Message 消息，消息是不具名的，它由消息头和消息体组成。消息体是不透明的，而消息头则由一系列的可选属性组成，这些属性包括routing-key（路由键）、priority（相对于其他消息的优先权）、delivery-mode（指出该消息可能需要持久性存储）等。</li>
<li>Publisher 消息的生产者，也是一个向交换器发布消息的客户端应用程序。</li>
<li>Exchange 交换器，用来接收生产者发送的消息并将这些消息路由给服务器中的队列。</li>
<li>Binding 绑定，用于消息队列和交换器之间的关联。一个绑定就是基于路由键将交换器和消息队列连接起来的路由规则，所以可以将交换器理解成一个由绑定构成的路由表。</li>
<li>Queue 消息队列，用来保存消息直到发送给消费者。它是消息的容器，也是消息的终点。一个消息可投入一个或多个队列。消息一直在队列里面，等待消费者连接到这个队列将其取走。</li>
<li>Connection 网络连接，比如一个TCP连接。</li>
<li>Channel 信道，多路复用连接中的一条独立的双向数据流通道。信道是建立在真实的TCP连接内地虚拟连接，AMQP 命令都是通过信道发出去的，不管是发布消息、订阅队列还是接收消息，这些动作都是通过信道完成。因为对于操作系统来说建立和销毁 TCP 都是非常昂贵的开销，所以引入了信道的概念，以复用一条 TCP 连接。</li>
<li>Consumer 消息的消费者，表示一个从消息队列中取得消息的客户端应用程序。</li>
<li>Virtual Host 虚拟主机，表示一批交换器、消息队列和相关对象。虚拟主机是共享相同的身份认证和加密环境的独立服务器域。每个 vhost 本质上就是一个 mini 版的 RabbitMQ 服务器，拥有自己的队列、交换器、绑定和权限机制。</li>
<li>Broker 表示消息队列服务器实体。</li>
</ol>
<h2 id="五、AMQP-中的消息路由"><a href="#五、AMQP-中的消息路由" class="headerlink" title="五、AMQP 中的消息路由"></a>五、AMQP 中的消息路由</h2><p>AMQP 中增加了 Exchange 交换机和 Binding 的角色。生产者把消息发送到交换机，由 Binging 和路由键共同决定消息应该发往哪个队列。</p>
<p>Exchange 根据分发消息时的类型有着不同的发送策略。总共四种类型：direct、fanout、topic、headers。</p>
<p>headers匹配的不是路由键而是消息的 header，但是用的很少。</p>
<h3 id="5-1-Direct"><a href="#5-1-Direct" class="headerlink" title="5.1 Direct"></a>5.1 Direct</h3><p><img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/161260568dc498b6"></p>
<p>如果消息头中的 路由键和 Binding 中的 binding key一致，交换器就将消息发送到对应的队列中。路由键与队列名完全匹配，如果一个队列绑定到交换机要求路由键为“dog”，则只转发 routing key 标记为“dog”的消息，不会转发“dog.puppy”，也不会转发“dog.guard”等等。它是完全匹配、单播的模式。</p>
<h3 id="5-2-Fanout"><a href="#5-2-Fanout" class="headerlink" title="5.2 Fanout"></a>5.2 Fanout</h3><p><img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/161260568fe5ce35"></p>
<p>每个发到 fanout 类型交换器的消息都会分到所有绑定的队列上去。fanout 交换器不处理路由键，只是简单的将队列绑定到交换器上，每个发送到交换器的消息都会被转发到与该交换器绑定的所有队列上。很像子网广播，每台子网内的主机都获得了一份复制的消息。fanout 类型转发消息是最快的。</p>
<h3 id="5-3-Topic"><a href="#5-3-Topic" class="headerlink" title="5.3 Topic"></a>5.3 Topic</h3><p><img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/161260569051565f"></p>
<p>topic 交换器通过模式匹配分配消息的路由键属性，将路由键和某个模式进行匹配，此时队列需要绑定到一个模式上。它将路由键和绑定键的字符串切分成单词，这些单词之间用点隔开。它同样也会识别两个通配符：符号“#”和符号“<em>”。#匹配0个或多个单词，</em>匹配不多不少一个单词。</p>
<h2 id="六、RabbitMQ-的运行"><a href="#六、RabbitMQ-的运行" class="headerlink" title="六、RabbitMQ 的运行"></a>六、RabbitMQ 的运行</h2><p>找到 RabbitMQ 安装后的 sbin 目录，里面有一个 rabbitmq-server 可执行文件，执行即可。</p>
<h3 id="6-1-启动-RabbitMQ"><a href="#6-1-启动-RabbitMQ" class="headerlink" title="6.1 启动 RabbitMQ"></a>6.1 启动 RabbitMQ</h3><p><code>./sbin/rabbitmq-server</code>：启动</p>
<p><code>./sbin/rabbitmq-server -detached</code>：后台启动</p>
<h3 id="6-2-查看-RabbitMQ-服务器状态信息"><a href="#6-2-查看-RabbitMQ-服务器状态信息" class="headerlink" title="6.2 查看 RabbitMQ 服务器状态信息"></a>6.2 查看 RabbitMQ 服务器状态信息</h3><p><code>./sbin/rabbitmqctl status</code>：查询 RabbitMQ 服务器的状态信息</p>
<h3 id="6-3-关闭-RabbitMQ-结点"><a href="#6-3-关闭-RabbitMQ-结点" class="headerlink" title="6.3 关闭 RabbitMQ 结点"></a>6.3 关闭 RabbitMQ 结点</h3><p>RabbitMQ 是使用 Erlang 语言写的，在 Erlang中有两个概念：<strong>结点和应用程序</strong>。结点就是 Erlang虚拟机的每个实例，而多个 Erlang 应用程序可以运行在同一个结点上。结点之间可以进行本地通信（不管它们是不是运行在同一台服务器上）。比如一个运行在结点A上的应用程序可以调用运行在B上的应用程序的方法。如果应用程序由于某些原因出现崩溃，Erlang 就会自动尝试重启。</p>
<p>关闭整个 RabbitMQ 结点：<code>./sbin/rabbitmqctl stop</code></p>
<p>也可以关闭远程结点： <code>./sbin/rabbitmqctl -n rabbit@server.example.com stop</code></p>
<p>-n node 默认 node 名称是 rabbit@server ，如果你的主机名是 server.example.com ，那么 node 名称就是 <a href="mailto:&#114;&#x61;&#98;&#x62;&#105;&#116;&#64;&#x73;&#101;&#114;&#118;&#x65;&#114;&#x2e;&#101;&#x78;&#x61;&#109;&#112;&#108;&#x65;&#46;&#99;&#111;&#109;">&#114;&#x61;&#98;&#x62;&#105;&#116;&#64;&#x73;&#101;&#114;&#118;&#x65;&#114;&#x2e;&#101;&#x78;&#x61;&#109;&#112;&#108;&#x65;&#46;&#99;&#111;&#109;</a> 。</p>
<h3 id="6-4-关闭-RabbitMQ-应用程序"><a href="#6-4-关闭-RabbitMQ-应用程序" class="headerlink" title="6.4 关闭 RabbitMQ 应用程序"></a>6.4 关闭 RabbitMQ 应用程序</h3><p>如果只想关闭 RabbitMQ 应用程序同时保持 Erlang 结点的运行，可以使用 stop_app</p>
<p><code>./sbin/rabbitmqctl stop_app</code></p>
<h3 id="6-5-启动-RabbitMQ-应用程序"><a href="#6-5-启动-RabbitMQ-应用程序" class="headerlink" title="6.5 启动 RabbitMQ 应用程序"></a>6.5 启动 RabbitMQ 应用程序</h3><p><code>./sbin/rabbitmqctl start_app</code></p>
<h3 id="6-6-重置-RabbitMQ-结点"><a href="#6-6-重置-RabbitMQ-结点" class="headerlink" title="6.6  重置 RabbitMQ 结点"></a>6.6  重置 RabbitMQ 结点</h3><p><code>./sbin/rabbitmqctl reset</code>    该命令会清除所有队列</p>
<h3 id="6-7-查看已经声明的队列"><a href="#6-7-查看已经声明的队列" class="headerlink" title="6.7  查看已经声明的队列"></a>6.7  查看已经声明的队列</h3><p><code>./sbin/rabbitmqctl list_queues</code></p>
<h3 id="6-8-查看交换器"><a href="#6-8-查看交换器" class="headerlink" title="6.8  查看交换器"></a>6.8  查看交换器</h3><p><code>./sbin/rabbitmqctl list_exchanges</code></p>
<p>该命令还可以附带参数，比如交换器的名称、类型、是否持久化是否自动删除</p>
<p><code>./sbin/rabbitmqctl list_exchanges name type durable auto_delete</code></p>
<h3 id="6-9-查看绑定"><a href="#6-9-查看绑定" class="headerlink" title="6.9  查看绑定"></a>6.9  查看绑定</h3><p><code>./sbin/rabbitmqctl list_bindings</code></p>
<h2 id="七、RabbitMQ-的安装"><a href="#七、RabbitMQ-的安装" class="headerlink" title="七、RabbitMQ 的安装"></a>七、RabbitMQ 的安装</h2><h3 id="7-1-下载-erlang"><a href="#7-1-下载-erlang" class="headerlink" title="7.1 下载 erlang"></a>7.1 下载 erlang</h3><p><a target="_blank" rel="noopener" href="https://www.erlang.org/downloads/22.3">https://www.erlang.org/downloads/22.3</a></p>
<p>版本参照 rabbitMQ 官网的对应版本</p>
<h3 id="7-2-下载-RabbitMQ"><a href="#7-2-下载-RabbitMQ" class="headerlink" title="7.2  下载 RabbitMQ"></a>7.2  下载 RabbitMQ</h3><p><img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/image-20210409150610436.png"></p>
<img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/image-20210409150627460.png" alt="image-20210409150627460" style="zoom: 50%;" />



<h3 id="7-3-上传服务器并解压"><a href="#7-3-上传服务器并解压" class="headerlink" title="7.3 上传服务器并解压"></a>7.3 上传服务器并解压</h3><p>注意 RabbitMQ压缩包为 .xz 格式，要先用 xz 命令进行解压为 .tar 文件，然后使用 tar 命令进行解压</p>
<p><code>xz -d rabbitmq-server-generic-unix-3.7.16.tar.xz</code>：解压 .xz 文件</p>
<p><code>tar -xvf rabbitmq-server-generic-unix-3.7.16.tar</code>：解压 .tar 文件</p>
<p>然后在 &#x2F;usr&#x2F;local 下创建一个 RabbitMQ文件夹用来存储RabbitMQ 软件运行时的数据等等，并将解压后的文件也移动到当前文件夹下。</p>
<h3 id="7-4-安装-Erlang"><a href="#7-4-安装-Erlang" class="headerlink" title="7.4 安装 Erlang"></a>7.4 安装 Erlang</h3><ol>
<li>安装 Erlang 编译所依赖的环境</li>
</ol>
<p><code>yum install make gcc gcc-c++ build-essential openssl openssl-devel unixODBC unixODBC-devel kernel-devel m4 ncurses-devel</code></p>
<ol start="2">
<li>在 &#x2F;usr&#x2F;local 目录下创建一个erlang文件夹，因为erlang编译安装默认是装在&#x2F;usr&#x2F;local下的bin和lib中，这里我们将他统一装到&#x2F;usr&#x2F;local&#x2F;erlang中，方便查找和使用</li>
</ol>
<p><code>mkdir -p /usr/local/erlang</code></p>
<ol start="3">
<li>编译Erlang</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd otp_src_22.0/        #进入Erlang目录下</span><br><span class="line">./configure --prefix=/usr/local/erlang --without-javac   #编译 erlang，这里不要使用java编译器了</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>安装 Erlang</li>
</ol>
<p><code>make &amp;&amp; make install</code></p>
<ol start="5">
<li>配置 Erlang 环境变量</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> vim /etc/profile           <span class="comment">//编译环境配置文件</span></span><br><span class="line"> </span><br><span class="line">   </span><br><span class="line"><span class="comment">//添加如下信息</span></span><br><span class="line">   export ERLANG_HOME=/usr/local/erlang</span><br><span class="line">   export PATH=$&#123;ERLANG_HOME&#125;/bin:$&#123;PATH&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//让配置生效</span></span><br><span class="line">   source /etc/profile</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>创建软连接</li>
</ol>
<p><code> ln -s /usr/local/erlang/bin/erl /usr/local/bin/erl</code></p>
<h3 id="7-5-安装-RabbitMQ"><a href="#7-5-安装-RabbitMQ" class="headerlink" title="7.5 安装 RabbitMQ"></a>7.5 安装 RabbitMQ</h3><ol>
<li>配置环境变量</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile    <span class="comment">//切换到目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//添加如下信息</span></span><br><span class="line">export RABBITMQ_HOME=/usr/local/RabbitMQ_Softwork/rabbitmq_server-<span class="number">3.8</span><span class="number">.11</span></span><br><span class="line">export PATH=$&#123;RABBITMQ_HOME&#125;/sbin:$&#123;PATH&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>开启web 管理界面</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//切换到 sbin 目录下</span></span><br><span class="line">cd /usr/local/RabbitMQ_Softwork/rabbitmq_server-<span class="number">3.8</span><span class="number">.11</span>/sbin</span><br><span class="line">  </span><br><span class="line"><span class="comment">//开启管理界面</span></span><br><span class="line">./rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>设置开机启动</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.d/rc.local</span><br><span class="line">  </span><br><span class="line"><span class="comment">//添加如下代码到 rc.local 文件中</span></span><br><span class="line"><span class="comment">//注意：1.手动启动，用户登陆后会去加载/etc/profile中的配置文件中 Erlang和RabbitMQ环境</span></span><br><span class="line"><span class="comment">//     2.开机启动，在系统识别用户前加载配置文件中的环境。</span></span><br><span class="line">   </span><br><span class="line">source /etc/profile     <span class="comment">//表示加载配置文件</span></span><br><span class="line">/usr/local/RabbitMQ_Softwork/rabbitmq_server-<span class="number">3.8</span><span class="number">.11</span>/sbin/rabbitmq-server -detached  <span class="comment">//后台启动</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>后台启动 RabbitMQ</li>
</ol>
<p><code>/usr/local/RabbitMQ_Softwork/rabbitmq_server-3.8.11/sbin/rabbitmq-server -detached</code></p>
<h3 id="7-6-浏览器访问-RabbitMQ"><a href="#7-6-浏览器访问-RabbitMQ" class="headerlink" title="7.6 浏览器访问 RabbitMQ"></a>7.6 浏览器访问 RabbitMQ</h3><p>浏览器端口 15672访问 RabbitMQ web管理界面，初始用户名和密码都为 guest</p>
<p><img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/image-20210409162025317.png"></p>
<p>可以看到Login failed (登录失败)，User can only log in via localhost (用户只能通过本地主机登录)，因为rabbitmq从3.3.0开始禁止使用guest&#x2F;guest管理员权限通过除localhost外的访问</p>
<p>解决方案：重新创建用户，设置权限进行登录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加用户</span></span><br><span class="line">rabbitmqctl add_user root <span class="number">123456</span>           <span class="comment">//创建用户名为root 密码为123456的用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//给用户设置标签</span></span><br><span class="line">rabbitmqctl set_user_tags root administrator</span><br><span class="line">  </span><br><span class="line"><span class="comment">//查看所有用户列表</span></span><br><span class="line">rabbitmqctl list_users</span><br><span class="line">  </span><br><span class="line"><span class="comment">//但是这样只能登录，无权访问虚拟主机，需要添加权限操作</span></span><br><span class="line"><span class="comment">//给root用户在虚拟主机&quot;/&quot;上的配置、写、读的权限</span></span><br><span class="line">rabbitmqctl set_permissions root -p / <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span> <span class="string">&quot;.*&quot;</span></span><br></pre></td></tr></table></figure>

<img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/image-20210409163648224.png" alt="image-20210409163648224" style="zoom:80%;" />



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"># 帮助命令</span><br><span class="line">[root@RabbitMQ ~]# rabbitmqctl help</span><br><span class="line">Error:</span><br><span class="line"></span><br><span class="line">Usage</span><br><span class="line"></span><br><span class="line">rabbitmqctl [--node &lt;node&gt;] [--timeout &lt;timeout&gt;] [--longnames] [--quiet] &lt;command&gt; [&lt;command options&gt;]</span><br><span class="line"></span><br><span class="line">Available commands:</span><br><span class="line"></span><br><span class="line">Help:</span><br><span class="line"></span><br><span class="line">   help                          Displays usage information for a command</span><br><span class="line">   version                       Displays CLI tools version</span><br><span class="line"></span><br><span class="line">Nodes:</span><br><span class="line"></span><br><span class="line">   await_startup                 Waits for the RabbitMQ application to start on the target node</span><br><span class="line">   reset                         Instructs a RabbitMQ node to leave the cluster and return to its virgin state</span><br><span class="line">   rotate_logs                   Instructs the RabbitMQ node to perform internal log rotation</span><br><span class="line">   shutdown                      Stops RabbitMQ and its runtime (Erlang VM). Monitors progress for local nodes. Does not require a PID file path.</span><br><span class="line">   start_app                     Starts the RabbitMQ application but leaves the runtime (Erlang VM) running</span><br><span class="line">   stop                          Stops RabbitMQ and its runtime (Erlang VM). Requires a local node pid file path to monitor progress.</span><br><span class="line">   stop_app                      Stops the RabbitMQ application, leaving the runtime (Erlang VM) running</span><br><span class="line">   wait                          Waits for RabbitMQ node startup by monitoring a local PID file. See also &#x27;rabbitmqctl await_online_nodes&#x27;</span><br><span class="line"></span><br><span class="line">Cluster:</span><br><span class="line"></span><br><span class="line">   await_online_nodes            Waits for &lt;count&gt; nodes to join the cluster</span><br><span class="line">   change_cluster_node_type      Changes the type of the cluster node</span><br><span class="line">   cluster_status                Displays all the nodes in the cluster grouped by node type, together with the currently running nodes</span><br><span class="line">   force_boot                    Forces node to start even if it cannot contact or rejoin any of its previously known peers</span><br><span class="line">   force_reset                   Forcefully returns a RabbitMQ node to its virgin state</span><br><span class="line">   forget_cluster_node           Removes a node from the cluster</span><br><span class="line">   join_cluster                  Instructs the node to become a member of the cluster that the specified node is in</span><br><span class="line">   rename_cluster_node           Renames cluster nodes in the local database</span><br><span class="line">   update_cluster_nodes          Instructs a cluster member node to sync the list of known cluster members from &lt;seed_node&gt;</span><br><span class="line"></span><br><span class="line">Replication:</span><br><span class="line"></span><br><span class="line">   cancel_sync_queue             Instructs a synchronising mirrored queue to stop synchronising itself</span><br><span class="line">   sync_queue                    Instructs a mirrored queue with unsynchronised mirrors (follower replicas) to synchronise them</span><br><span class="line"></span><br><span class="line">Users:</span><br><span class="line"></span><br><span class="line">   add_user                      Creates a new user in the internal database</span><br><span class="line">   authenticate_user             Attempts to authenticate a user. Exits with a non-zero code if authentication fails.</span><br><span class="line">   change_password               Changes the user password</span><br><span class="line">   clear_password                Clears (resets) password and disables password login for a user</span><br><span class="line">   delete_user                   Removes a user from the internal database. Has no effect on users provided by external backends such as LDAP</span><br><span class="line">   list_users                    List user names and tags</span><br><span class="line">   set_user_tags                 Sets user tags</span><br><span class="line"></span><br><span class="line">Access Control:</span><br><span class="line"></span><br><span class="line">   clear_permissions             Revokes user permissions for a vhost</span><br><span class="line">   clear_topic_permissions       Clears user topic permissions for a vhost or exchange</span><br><span class="line">   list_permissions              Lists user permissions in a virtual host</span><br><span class="line">   list_topic_permissions        Lists topic permissions in a virtual host</span><br><span class="line">   list_user_permissions         Lists permissions of a user across all virtual hosts</span><br><span class="line">   list_user_topic_permissions   Lists user topic permissions</span><br><span class="line">   list_vhosts                   Lists virtual hosts</span><br><span class="line">   set_permissions               Sets user permissions for a vhost</span><br><span class="line">   set_topic_permissions         Sets user topic permissions for an exchange</span><br><span class="line"></span><br><span class="line">Monitoring, observability and health checks:</span><br><span class="line"></span><br><span class="line">   environment                   Displays the name and value of each variable in the application environment for each running application</span><br><span class="line">   list_bindings                 Lists all bindings on a vhost</span><br><span class="line">   list_channels                 Lists all channels in the node</span><br><span class="line">   list_ciphers                  Lists cipher suites supported by encoding commands</span><br><span class="line">   list_connections              Lists AMQP 0.9.1 connections for the node</span><br><span class="line">   list_consumers                Lists all consumers for a vhost</span><br><span class="line">   list_exchanges                Lists exchanges</span><br><span class="line">   list_hashes                   Lists hash functions supported by encoding commands</span><br><span class="line">   list_queues                   Lists queues and their properties</span><br><span class="line">   list_unresponsive_queues      Tests queues to respond within timeout. Lists those which did not respond</span><br><span class="line">   ping                          Checks that the node OS process is up, registered with EPMD and CLI tools can authenticate with it</span><br><span class="line">   report                        Generate a server status report containing a concatenation of all server status information for support purposes</span><br><span class="line">   schema_info                   Lists schema database tables and their properties</span><br><span class="line">   status                        Displays status of a node</span><br><span class="line"></span><br><span class="line">Parameters:</span><br><span class="line"></span><br><span class="line">   clear_global_parameter        Clears a global runtime parameter</span><br><span class="line">   clear_parameter               Clears a runtime parameter.</span><br><span class="line">   list_global_parameters        Lists global runtime parameters</span><br><span class="line">   list_parameters               Lists runtime parameters for a virtual host</span><br><span class="line">   set_global_parameter          Sets a runtime parameter.</span><br><span class="line">   set_parameter                 Sets a runtime parameter.</span><br><span class="line"></span><br><span class="line">Policies:</span><br><span class="line"></span><br><span class="line">   clear_operator_policy         Clears an operator policy</span><br><span class="line">   clear_policy                  Clears (removes) a policy</span><br><span class="line">   list_operator_policies        Lists operator policy overrides for a virtual host</span><br><span class="line">   list_policies                 Lists all policies in a virtual host</span><br><span class="line">   set_operator_policy           Sets an operator policy that overrides a subset of arguments in user policies</span><br><span class="line">   set_policy                    Sets or updates a policy</span><br><span class="line"></span><br><span class="line">Virtual hosts:</span><br><span class="line"></span><br><span class="line">   add_vhost                     Creates a virtual host</span><br><span class="line">   clear_vhost_limits            Clears virtual host limits</span><br><span class="line">   delete_vhost                  Deletes a virtual host</span><br><span class="line">   list_vhost_limits             Displays configured virtual host limits</span><br><span class="line">   restart_vhost                 Restarts a failed vhost data stores and queues</span><br><span class="line">   set_vhost_limits              Sets virtual host limits</span><br><span class="line">   trace_off                     </span><br><span class="line">   trace_on                      </span><br><span class="line"></span><br><span class="line">Node configuration:</span><br><span class="line"></span><br><span class="line">   decode                        Decrypts an encrypted configuration value</span><br><span class="line">   encode                        Encrypts a sensitive configuration value</span><br><span class="line">   set_cluster_name              Sets the cluster name</span><br><span class="line">   set_disk_free_limit           Sets the disk_free_limit setting</span><br><span class="line">   set_log_level                 Sets log level in the running node</span><br><span class="line">   set_vm_memory_high_watermark  Sets the vm_memory_high_watermark setting</span><br><span class="line"></span><br><span class="line">Definitions:</span><br><span class="line"></span><br><span class="line">   export_definitions            Exports definitions in JSON or compressed Erlang Term Format.</span><br><span class="line">   import_definitions            Imports definitions in JSON or compressed Erlang Term Format.</span><br><span class="line"></span><br><span class="line">Deprecated:</span><br><span class="line"></span><br><span class="line">   node_health_check             DEPRECATED. Performs intrusive, opinionated health checks on a fully booted node. See https://www.rabbitmq.com/monitoring.html#health-checks instead</span><br><span class="line"></span><br><span class="line">Feature flags:</span><br><span class="line"></span><br><span class="line">   enable_feature_flag           Enables a feature flag on target node</span><br><span class="line">   list_feature_flags            Lists feature flags</span><br><span class="line"></span><br><span class="line">Operations:</span><br><span class="line"></span><br><span class="line">   close_all_connections         Instructs the broker to close all connections for the specified vhost or entire RabbitMQ node</span><br><span class="line">   close_connection              Instructs the broker to close the connection associated with the Erlang process id</span><br><span class="line">   eval                          Evaluates a snippet of Erlang code on the target node</span><br><span class="line">   exec                          Evaluates a snippet of Elixir code on the CLI node</span><br><span class="line">   force_gc                      Makes all Erlang processes on the target node perform/schedule a full sweep garbage collection</span><br><span class="line">   hipe_compile                  Only exists for backwards compatibility. HiPE support has been dropped starting with Erlang 22. Do not use</span><br><span class="line"></span><br><span class="line">Queues:</span><br><span class="line"></span><br><span class="line">   delete_queue                  Deletes a queue</span><br><span class="line">   purge_queue                   Purges a queue (removes all messages in it)</span><br><span class="line"></span><br><span class="line">Use &#x27;rabbitmqctl help &lt;command&gt;&#x27; to learn more about a specific command</span><br></pre></td></tr></table></figure>



<h2 id="八、Java客户端访问-RabbitMQ"><a href="#八、Java客户端访问-RabbitMQ" class="headerlink" title="八、Java客户端访问 RabbitMQ"></a>八、Java客户端访问 RabbitMQ</h2><h3 id="消息生产者代码模板"><a href="#消息生产者代码模板" class="headerlink" title="消息生产者代码模板"></a>消息生产者代码模板</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageProvider</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//1.建立连接</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        factory.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        factory.setHost(<span class="string">&quot;39.100.119.221&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取信道,声明交换机</span></span><br><span class="line">        <span class="comment">//获取信道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> conn.createChannel();</span><br><span class="line">        <span class="comment">//声明交换机</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hello-exchange&quot;</span>;</span><br><span class="line">        channel.exchangeDeclare(exchangeName,<span class="string">&quot;direct&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//声明路由键</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> <span class="string">&quot;hola&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.发布消息</span></span><br><span class="line">        <span class="type">byte</span>[] messageBodyBytes = <span class="string">&quot;Hello RabbitMQ&quot;</span>.getBytes();</span><br><span class="line">        channel.basicPublish(exchangeName,routingKey,<span class="literal">null</span>,messageBodyBytes);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.关闭资源</span></span><br><span class="line">        channel.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>消息生产者主要关注的就是生产消息，然后将消息交给交换机。剩下的消息的转接都由交换机去完成。</p>
<p>消费者传输消息时需要声明交换机的类型，包括（<code>direct</code>、<code>fanout</code>、<code>topic</code>、<code>headers</code>），通过信道来传输数据，因此要建立信道和交换机之间的关联。</p>
<p>最后需要定义路由键，因为需要通过路由键来绑定交换机和消息队列。</p>
<h3 id="消息消费者代码模板"><a href="#消息消费者代码模板" class="headerlink" title="消息消费者代码模板"></a>消息消费者代码模板</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageConsumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//1.获取连接</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        factory.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        factory.setHost(<span class="string">&quot;39.100.119.221&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">            System.out.println(<span class="string">&quot;连接获取成功！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取信道、声明交换机、声明队列、定义路由键</span></span><br><span class="line">        <span class="comment">//获取信道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> conn.createChannel();</span><br><span class="line">        <span class="comment">//声明交换机</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;hello-exchange&quot;</span>;</span><br><span class="line">        channel.exchangeDeclare(exchangeName,<span class="string">&quot;direct&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//声明队列</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> channel.queueDeclare().getQueue();</span><br><span class="line">        <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> <span class="string">&quot;hola&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.通过路由键绑定队列与交换机</span></span><br><span class="line">        channel.queueBind(queueName,exchangeName,routingKey);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.接收消息</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//消费消息</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">consumerTag</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            channel.basicConsume(queueName,autoAck,consumerTag,<span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel)&#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                    <span class="comment">//路由键</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> envelope.getRoutingKey();</span><br><span class="line">                    <span class="comment">//消息类型</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">contentType</span> <span class="operator">=</span> properties.getContentType();</span><br><span class="line">                    System.out.println(<span class="string">&quot;路由键为：&quot;</span>+routingKey);</span><br><span class="line">                    System.out.println(<span class="string">&quot;消息类型为：&quot;</span>+contentType);</span><br><span class="line">                    <span class="type">long</span> <span class="variable">deliveryTag</span> <span class="operator">=</span> envelope.getDeliveryTag();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//确认消息</span></span><br><span class="line">                    channel.basicAck(deliveryTag,autoAck);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//消息的内容</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">                    System.out.println(<span class="string">&quot;消息的内容为：&quot;</span>+message);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>消费者只关注从队列中获取数据，队列需要和交换机进行绑定，因此需要声明路由键、交换机、队列。</li>
</ul>
<p>​        然后通过 <code>channel.queueBind(queueName,exchangeName,routingKey)</code>来绑定交换机和队列。</p>
<ul>
<li>消费者接收消息是通过  channel.basicConsume()   方法来进行的，详细介绍如上。</li>
</ul>
<p>最后注意Java连接RabbitMQ 是通过 5672 端口进行的，而 15672是浏览器访问 RabbitMQ管理界面的端口，因此需要在Linux中打开 5672 端口。</p>
<p><img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/image-20210409190430799.png"></p>
<h2 id="九、RabbitMQ-集群"><a href="#九、RabbitMQ-集群" class="headerlink" title="九、RabbitMQ 集群"></a>九、RabbitMQ 集群</h2><h3 id="9-1-为什么使用集群？"><a href="#9-1-为什么使用集群？" class="headerlink" title="9.1 为什么使用集群？"></a>9.1 为什么使用集群？</h3><p>（1）允许消费者和生产者在 RabbitMQ 结点崩溃时仍然能够保证正常的通信；</p>
<p>（2）增加结点来扩展 RabbitMQ 处理更多的消息，承载更多的业务量。</p>
<h3 id="9-2-集群的特点"><a href="#9-2-集群的特点" class="headerlink" title="9.2 集群的特点"></a>9.2 集群的特点</h3><blockquote>
<p>集群是由多个结点组成的，但不是每个结点都有所有队列的完整数据。—— 结点的不完全拷贝性</p>
</blockquote>
<ol>
<li>RabbitMQ 会始终记录以下四种类型的内部数据</li>
</ol>
<p>（1）队列元数据   包括队列的名称、属性，比如是否可以持久化，是否自动删除；</p>
<p>（2）交换机元数据   包括交换机的名称、属性、类型；</p>
<p>（3）绑定元数据  内部是一张表格，记录如何将消息路由到队列；</p>
<p>（4）vhost元数据  为vhost 内部的队列、交换机、绑定提供命名空间和安全属性；</p>
<ol start="2">
<li>存储形式的不同</li>
</ol>
<p>在单一节点中，RabbitMQ 会将上述的四种类型的元数据存储在内存中，同时将可持久化的队列、交换机、绑定存储到磁盘上。存储到磁盘上保证了重启后能够恢复数据状态；</p>
<p>在集群中创建队列，只会在<strong>单个节点</strong>上创建完整的队列信息（元数据、状态、内容）。结果是只有队列所有者知道队列有关的所有信息，如果这个结点崩溃，该结点的队列和绑定就消失了，该队列的任何消息也就都消失了。好在  RabbitMQ 2.6.0 之后提供了 镜像队列来避免节点崩溃导致队列不可用的情况。</p>
<p>如上所说，RabbitMQ 可以共享 user、vhost、exchange等，所有的数据状态都是必须在所有结点上复制的，例外就是队列。</p>
<p>集群中有内存结点和磁盘结点两种类型，内存结点性能更好、速度更快，但是对于需要持久化的队列、交换机、绑定而言就必须使用磁盘节点，它保证了重启后仍然能够恢复数据。因此<strong>集群中必须至少有1个磁盘节点</strong>，如果这个结点崩溃了，那该集群可以继续路由消息，但是不能创建队列、交换机、绑定，不能创建用户、修改用户权限等等。也就是说如何唯一的磁盘节点崩溃，那么集群仍然可以运行，但是不能更改任何东西直到它恢复。</p>
<ol start="3">
<li>为什么默认情况下不让队列的内容和状态复制到所有结点？</li>
</ol>
<p>（1）存储空间 —– 如果将队列的内容和状态复制到所有的结点，那么新增结点反而没有增大容量，而是增加了冗余数据；</p>
<p>（2）性能 —–  如果需要将消息发布拷贝到每一个结点，那么对于网络负载还有磁盘负载都会有所增加，与建立集群的初衷相违背。</p>
<h3 id="9-3-集群的异常处理"><a href="#9-3-集群的异常处理" class="headerlink" title="9.3 集群的异常处理"></a>9.3 集群的异常处理</h3><p>如果集群的结点崩溃了，那么该结点的队列和关联的绑定就都丢失了。</p>
<p>解决办法：如果该结点消息已经进行了持久化，那么等待结点恢复就可以了；</p>
<p>​                    如果未进行持久化，需要使用双活冗余队列、镜像队列。</p>
<h3 id="9-4-集群的搭建"><a href="#9-4-集群的搭建" class="headerlink" title="9.4 集群的搭建"></a>9.4 集群的搭建</h3><blockquote>
<p>这里使用比较热门的方法，使用 docker 来下载启动搭建 rabbitmq 集群</p>
</blockquote>
<ol>
<li>安装 rabbitmq 镜像</li>
</ol>
<p><code>docker pull rabbitmq:3.6.15-management</code></p>
<p>  后面的 -management  是指包含网页控制台的。</p>
<p>安装成功后使用 <code>docker images</code>来查看现有的镜像。<img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/image-20210410142828183.png"></p>
<p><strong>列举一下Docker常用命令：</strong></p>
<p>（1）容器启动： docker start  容器名称；</p>
<p>（2）容器停止： docker stop  容器名称；</p>
<p>（3）删除容器： docker rm  容器名称&#x2F;容器ID；</p>
<p>（4）删除镜像： docker rmi  镜像名称&#x2F;镜像ID；</p>
<p>（5）查看所有镜像：docker images；</p>
<p>（6）查看运行中的容器：docker ps；</p>
<p>（7）查看所有容器： docker ps -a；</p>
<p>（8）进入docker目录：docker exec -it &#x2F;bin&#x2F;bash；</p>
<p>（9）启动容器：docker run -d  -h hostName -p  HostPort:ContainerPort  –name ContainerName  镜像名&#x2F;镜像ID:tag</p>
<ol start="2">
<li>启动多个 rabbitmq</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//启动第一个  端口映射 5672:5672 15672:15672</span></span><br><span class="line">docker run -d -p <span class="number">5672</span>:<span class="number">5672</span> -p <span class="number">15672</span>:<span class="number">15672</span> -h rabbit1 -e RABBITMQ_ERLANG_COOKIE=<span class="string">&#x27;rabbitcookie&#x27;</span> --name myrabbit1 rabbitmq:management</span><br><span class="line"></span><br><span class="line"><span class="comment">//启动第二个  端口映射 5673:5672 15673:15672</span></span><br><span class="line">docker run -d -p <span class="number">5673</span>:<span class="number">5672</span> -p <span class="number">15673</span>:<span class="number">15672</span> -h rabbit2 -e RABBITMQ_ERLANG_COOKIE=<span class="string">&#x27;rabbitcookie&#x27;</span> --name myrabbit2 --link myrabbit1:rabbit1 rabbitmq:management</span><br><span class="line">  </span><br><span class="line"><span class="comment">//启动第二个  端口映射 5674:5672 15674:15672</span></span><br><span class="line">docker run -d -p <span class="number">5674</span>:<span class="number">5674</span> -p <span class="number">15674</span>:<span class="number">15674</span> -h rabbit3 -e RABBITMQ_ERLANG_COOKIE=<span class="string">&#x27;rabbitcookie&#x27;</span> --name myrabbit3 --link myrabbit1:rabbit1 --link myrabbit2:rabbit2 rabbitmq:management</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>多个容器之间必须通过 <code>--link</code>进行连接，此属性不能少；</p>
<p>​             Erlang Cookie 必须相同，原因是：RabbitMQ 是通过 Erlang语言编写的，Erlang Cookie相当于各个结点之间的通信秘钥，Erlang结点通过交换 Erlang Cookie来获取认证。</p>
<ol start="3">
<li>加入RabbitMQ 结点到集群</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置结点1</span></span><br><span class="line">docker exec -it myrabbit1 bash   <span class="comment">//进入容器</span></span><br><span class="line">rabbitmqctl stop_app      <span class="comment">//同步数据</span></span><br><span class="line">rabbitmqctl reset         </span><br><span class="line">rabbitmqctl start_app     </span><br><span class="line">exit</span><br><span class="line">  </span><br><span class="line"><span class="comment">//设置结点2</span></span><br><span class="line">docker exec -it myrabbit2 bash</span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line">rabbitmqctl reset</span><br><span class="line">rabbitmqctl join_cluster --ram rabbit<span class="meta">@rabbit1</span></span><br><span class="line">rabbitmqctl start_app</span><br><span class="line">exit</span><br><span class="line">  </span><br><span class="line"><span class="comment">//设置结点3</span></span><br><span class="line">docker exec -it myrabbit3 bash</span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line">rabbitmqctl reset</span><br><span class="line">rabbitmqctl join_cluster --ram rabbit<span class="meta">@rabbit1</span></span><br><span class="line">rabbitmqctl start_app</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>由于初始时每个结点都是独立的状态，不知道其它结点的存在，因此需要停止程序然后重置结点来同步数据，然后再加入到集群中。   <code>--ram</code> 表示设置为内存结点，忽略此参数默认为磁盘结点</p>
<ol start="4">
<li>这样就启动了3个结点，一个磁盘结点，两个内存结点，3个结点一起构成了 RabbitMQ 集群</li>
</ol>
<p><img src="/img/loading.gif" data-original="/passageImg/RabbitMQ.assets/image-20210410153619367.png"></p>
<ol start="5">
<li>集群其余操作</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//更改结点类型</span></span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line">rabbitmqctl change_cluster_node_type dist    <span class="comment">//更改为磁盘结点</span></span><br><span class="line">rabbitmqctl change_cluster_node_type ram     <span class="comment">//更改为内存结点</span></span><br><span class="line">rabbitmqctl start_app</span><br><span class="line">  </span><br><span class="line"><span class="comment">//移除结点</span></span><br><span class="line">rabbitmqctl stop_app</span><br><span class="line">rabbitmqctl reset</span><br><span class="line">rabbitmqctl start_app</span><br></pre></td></tr></table></figure>

<p>集群启动时，先是磁盘结点然后是内存结点(顺序是固定地)；集群关闭时，先是内存结点然后是磁盘结点</p>
<h2 id="十、镜像队列"><a href="#十、镜像队列" class="headerlink" title="十、镜像队列"></a>十、镜像队列</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013256816/article/details/71097186">https://blog.csdn.net/u013256816/article/details/71097186</a></p>
<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/269917155">https://zhuanlan.zhihu.com/p/269917155</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39135287/article/details/95725385?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_baidulandingword-0&amp;spm=1001.2101.3001.4242">https://blog.csdn.net/qq_39135287/article/details/95725385?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_baidulandingword-0&amp;spm=1001.2101.3001.4242</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903554721775629#heading-12">https://juejin.cn/post/6844903554721775629#heading-12</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/vipstone/p/9362388.html">https://www.cnblogs.com/vipstone/p/9362388.html</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">XjX-zc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2020/12/20/RabbitMQ_%E5%85%A5%E9%97%A8/">http://example.com/2020/12/20/RabbitMQ_入门/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">iStitches</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/RabbitMQ/">RabbitMQ</a></div><div class="post_share"><div class="social-share" data-image="/img/RabbitMQ.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/01/10/Java%E6%BA%90%E7%A0%81_HashMap%E6%BA%90%E7%A0%81/"><img class="prev-cover" src="/img/loading.gif" data-original="/img/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">HashMap源码解读</div></div></a></div><div class="next-post pull-right"><a href="/2020/11/20/%E7%89%9B%E5%AE%A2%E5%89%91%E6%8C%87offer_t20~t40/"><img class="next-cover" src="/img/loading.gif" data-original="/img/%E7%89%9B%E5%AE%A2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">牛客剑指offer(20~40题总结)</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">XjX-zc</div><div class="author-info__description">生活原本沉闷,但跑起来就会有风</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">48</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/iStitches"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="/atom.xml" target="_blank" title="RSS链接"><i class="iconfont icon-social-rss card_icon"></i></a><a class="social-icon" href="https://github.com/iStitches" target="_blank" title="Github"><i class="iconfont icon-icon-Github card_icon"></i></a><a class="social-icon" href="https://blog.csdn.net/qq_43684985?spm=1000.2115.3001.5343" target="_blank" title="CSDN"><i class="iconfont icon-icon-csdn card_icon"></i></a><a class="social-icon" href="https://space.bilibili.com/407787894" target="_blank" title="Bilibili"><i class="iconfont icon-icon_bilibili card_icon"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=1093453695&amp;website=www.oicqzone.com" target="_blank" title="QQ"><i class="iconfont icon-icon-QQ card_icon"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">开发菜鸡,欢迎大家光临,一起学习进步！！！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E5%8F%AB%E5%81%9A%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">1.</span> <span class="toc-text">一、什么叫做消息队列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%87%BA%E7%8E%B0%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">2.</span> <span class="toc-text">二、消息队列出现的原因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81RabbitMQ-%E7%89%B9%E7%82%B9"><span class="toc-number">3.</span> <span class="toc-text">三、RabbitMQ 特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81RabbitMQ-%E4%B8%AD%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">4.</span> <span class="toc-text">四、RabbitMQ 中的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%B6%88%E6%81%AF%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 消息模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-RabbitMQ-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 RabbitMQ 基本概念</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81AMQP-%E4%B8%AD%E7%9A%84%E6%B6%88%E6%81%AF%E8%B7%AF%E7%94%B1"><span class="toc-number">5.</span> <span class="toc-text">五、AMQP 中的消息路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Direct"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 Direct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-Fanout"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 Fanout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-Topic"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 Topic</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81RabbitMQ-%E7%9A%84%E8%BF%90%E8%A1%8C"><span class="toc-number">6.</span> <span class="toc-text">六、RabbitMQ 的运行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%90%AF%E5%8A%A8-RabbitMQ"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 启动 RabbitMQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E6%9F%A5%E7%9C%8B-RabbitMQ-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 查看 RabbitMQ 服务器状态信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%85%B3%E9%97%AD-RabbitMQ-%E7%BB%93%E7%82%B9"><span class="toc-number">6.3.</span> <span class="toc-text">6.3 关闭 RabbitMQ 结点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E5%85%B3%E9%97%AD-RabbitMQ-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">6.4.</span> <span class="toc-text">6.4 关闭 RabbitMQ 应用程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E5%90%AF%E5%8A%A8-RabbitMQ-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">6.5.</span> <span class="toc-text">6.5 启动 RabbitMQ 应用程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-6-%E9%87%8D%E7%BD%AE-RabbitMQ-%E7%BB%93%E7%82%B9"><span class="toc-number">6.6.</span> <span class="toc-text">6.6  重置 RabbitMQ 结点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-7-%E6%9F%A5%E7%9C%8B%E5%B7%B2%E7%BB%8F%E5%A3%B0%E6%98%8E%E7%9A%84%E9%98%9F%E5%88%97"><span class="toc-number">6.7.</span> <span class="toc-text">6.7  查看已经声明的队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-%E6%9F%A5%E7%9C%8B%E4%BA%A4%E6%8D%A2%E5%99%A8"><span class="toc-number">6.8.</span> <span class="toc-text">6.8  查看交换器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-9-%E6%9F%A5%E7%9C%8B%E7%BB%91%E5%AE%9A"><span class="toc-number">6.9.</span> <span class="toc-text">6.9  查看绑定</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81RabbitMQ-%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">7.</span> <span class="toc-text">七、RabbitMQ 的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%B8%8B%E8%BD%BD-erlang"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 下载 erlang</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E4%B8%8B%E8%BD%BD-RabbitMQ"><span class="toc-number">7.2.</span> <span class="toc-text">7.2  下载 RabbitMQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E4%B8%8A%E4%BC%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B9%B6%E8%A7%A3%E5%8E%8B"><span class="toc-number">7.3.</span> <span class="toc-text">7.3 上传服务器并解压</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E5%AE%89%E8%A3%85-Erlang"><span class="toc-number">7.4.</span> <span class="toc-text">7.4 安装 Erlang</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-%E5%AE%89%E8%A3%85-RabbitMQ"><span class="toc-number">7.5.</span> <span class="toc-text">7.5 安装 RabbitMQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE-RabbitMQ"><span class="toc-number">7.6.</span> <span class="toc-text">7.6 浏览器访问 RabbitMQ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81Java%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE-RabbitMQ"><span class="toc-number">8.</span> <span class="toc-text">八、Java客户端访问 RabbitMQ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E8%80%85%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF"><span class="toc-number">8.1.</span> <span class="toc-text">消息生产者代码模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E8%80%85%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF"><span class="toc-number">8.2.</span> <span class="toc-text">消息消费者代码模板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81RabbitMQ-%E9%9B%86%E7%BE%A4"><span class="toc-number">9.</span> <span class="toc-text">九、RabbitMQ 集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%9F"><span class="toc-number">9.1.</span> <span class="toc-text">9.1 为什么使用集群？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E9%9B%86%E7%BE%A4%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">9.2.</span> <span class="toc-text">9.2 集群的特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E9%9B%86%E7%BE%A4%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">9.3.</span> <span class="toc-text">9.3 集群的异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-%E9%9B%86%E7%BE%A4%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-number">9.4.</span> <span class="toc-text">9.4 集群的搭建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E9%95%9C%E5%83%8F%E9%98%9F%E5%88%97"><span class="toc-number">10.</span> <span class="toc-text">十、镜像队列</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/03/31/hello-world/" title="Hello World"><img src="/img/loading.gif" data-original="https://upimage.alexhchu.com/2020/10/21/f5ac68ddaaf64.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2022/03/31/hello-world/" title="Hello World">Hello World</a><time datetime="2022-03-31T09:49:07.771Z" title="发表于 2022-03-31 17:49:07">2022-03-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/26/%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B(1)/" title="计算机网络 自顶向下方法(应用层)"><img src="/img/loading.gif" data-original="http://gitee.com/MoYu-zc/picgo/raw/master/img/20211006143051.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络 自顶向下方法(应用层)"/></a><div class="content"><a class="title" href="/2021/10/26/%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B(1)/" title="计算机网络 自顶向下方法(应用层)">计算机网络 自顶向下方法(应用层)</a><time datetime="2021-10-26T08:47:02.000Z" title="发表于 2021-10-26 16:47:02">2021-10-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/11/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E2%80%94%E2%80%94%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E4%B8%8E%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5/" title="深入理解Java虚拟机—垃圾收集器与内存分配策略"><img src="/img/loading.gif" data-original="/img/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入理解Java虚拟机—垃圾收集器与内存分配策略"/></a><div class="content"><a class="title" href="/2021/07/11/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E2%80%94%E2%80%94%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E4%B8%8E%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5/" title="深入理解Java虚拟机—垃圾收集器与内存分配策略">深入理解Java虚拟机—垃圾收集器与内存分配策略</a><time datetime="2021-07-11T14:06:00.000Z" title="发表于 2021-07-11 22:06:00">2021-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/11/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E2%80%94%E2%80%94Java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/" title="深入理解Java虚拟机—Java内存区域"><img src="/img/loading.gif" data-original="/img/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入理解Java虚拟机—Java内存区域"/></a><div class="content"><a class="title" href="/2021/07/11/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E2%80%94%E2%80%94Java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/" title="深入理解Java虚拟机—Java内存区域">深入理解Java虚拟机—Java内存区域</a><time datetime="2021-07-11T13:06:00.000Z" title="发表于 2021-07-11 21:06:00">2021-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/05/10/TCP%E4%B8%89%E6%8F%A1%E5%9B%9B%E6%8C%A5%E6%8B%93%E5%B1%95/" title="TCP三握四挥知识拓展"><img src="/img/loading.gif" data-original="/img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TCP三握四挥知识拓展"/></a><div class="content"><a class="title" href="/2021/05/10/TCP%E4%B8%89%E6%8F%A1%E5%9B%9B%E6%8C%A5%E6%8B%93%E5%B1%95/" title="TCP三握四挥知识拓展">TCP三握四挥知识拓展</a><time datetime="2021-05-10T10:12:00.000Z" title="发表于 2021-05-10 18:12:00">2021-05-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By XjX-zc</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>